@page
@{
    ViewData["Title"] = "Cyber Snake v3.0";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <title>Cyber Snake Ultimate</title>
    <style>
        body {
            background-color: #050505;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            margin: 0; overflow: hidden; height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .game-container { position: relative; text-align: center; }
        canvas {
            border: 2px solid #00ff41;
            background-color: #001100;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.4);
            display: block;
        }
        .hud { font-size: 20px; margin-bottom: 15px; text-shadow: 0 0 10px #00ff41; letter-spacing: 2px; }
        .controls { margin-top: 15px; color: #666; font-size: 14px; }
        .btn-back {
            display: inline-block; margin-top: 20px; color: #00ff41; text-decoration: none;
            border: 1px solid #00ff41; padding: 8px 16px; transition: 0.3s; font-size: 12px; text-transform: uppercase;
        }
        .btn-back:hover { background-color: #00ff41; color: black; box-shadow: 0 0 15px #00ff41; }
    </style>
</head>
<body>

    <div class="game-container">
        <h1 style="margin: 0 0 20px 0; font-size: 40px;">CYBER SNAKE v3.0</h1>
        
        <div class="hud">
            POÄNG: <span id="score">0</span> | HIGHSCORE: <span id="highScore">0</span>
        </div>

        <canvas id="gameCanvas" width="500" height="500"></canvas>

        <div class="controls">
            [PILAR] STYR • [SPACE] OMSTART
        </div>
        
        <a href="/" class="btn-back">Avbryt / Tillbaka</a>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        let gridSize = 25; 
        let tileCount = canvas.width / gridSize;
        
        let px=10, py=10;
        let xv=0, yv=0;
        let trail=[];
        let tail=5;
        
        // Vanligt äpple (Rött)
        let ax=15, ay=15;
        
        // Bonusäpple (Guld)
        let bonus = { x: -1, y: -1, active: false, timer: 0 };
        
        let score=0;
        let highScore=0;
        let active=true;

        window.onload = function() {
            document.addEventListener("keydown", keyPush);
            setInterval(game, 1000/15);
        };

        function game() {
            if(!active) { drawFail(); return; }

            px += xv; py += yv;

            // Wrap-around
            if(px < 0) px = tileCount-1;
            if(px > tileCount-1) px = 0;
            if(py < 0) py = tileCount-1;
            if(py > tileCount-1) py = 0;

            // Rita bakgrund
            ctx.fillStyle = "#001100";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Rita rutnät
            ctx.strokeStyle = "#002200";
            ctx.lineWidth = 0.5;
            for(let i=0; i<tileCount; i++) {
                ctx.beginPath(); ctx.moveTo(i*gridSize, 0); ctx.lineTo(i*gridSize, canvas.height); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, i*gridSize); ctx.lineTo(canvas.width, i*gridSize); ctx.stroke();
            }

            // HANTERA BONUSÄPPLE (Slumpmässigt)
            if (!bonus.active) {
                // 1% chans varje frame att ett guldäpple dyker upp
                if (Math.random() < 0.01) {
                    bonus.x = Math.floor(Math.random() * tileCount);
                    bonus.y = Math.floor(Math.random() * tileCount);
                    bonus.active = true;
                    bonus.timer = 100; // Det stannar i ca 6 sekunder
                }
            } else {
                bonus.timer--;
                if (bonus.timer <= 0) bonus.active = false;
            }

            // RITA ORMEN (Snyggare grafik)
            for(let i=0; i<trail.length; i++) {
                let segment = trail[i];
                let isHead = (i === trail.length - 1);

                ctx.fillStyle = isHead ? "#00ff41" : "#00cc33"; // Ljusare huvud
                
                // Rita runda segment istället för fyrkanter
                ctx.beginPath();
                let radius = (gridSize / 2) - 1;
                let cx = segment.x * gridSize + gridSize/2;
                let cy = segment.y * gridSize + gridSize/2;
                ctx.arc(cx, cy, radius, 0, 2 * Math.PI);
                ctx.fill();

                // Rita ÖGON på huvudet
                if (isHead) {
                    ctx.fillStyle = "white";
                    let eyeOffset = 6;
                    let eyeSize = 3;
                    // Enkelt trick: rita ögonen lite framför mitten beroende på riktning
                    // (Här ritar vi dem bara centrerat för enkelhetens skull, ser gulligt ut)
                    ctx.beginPath(); ctx.arc(cx - 5, cy - 5, eyeSize, 0, Math.PI*2); ctx.fill();
                    ctx.beginPath(); ctx.arc(cx + 5, cy - 5, eyeSize, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = "black"; // Pupiller
                    ctx.beginPath(); ctx.arc(cx - 5, cy - 5, 1, 0, Math.PI*2); ctx.fill();
                    ctx.beginPath(); ctx.arc(cx + 5, cy - 5, 1, 0, Math.PI*2); ctx.fill();
                }

                if(segment.x == px && segment.y == py) {
                    if(tail > 5) active = false;
                }
            }

            trail.push({x:px, y:py});
            while(trail.length > tail) { trail.shift(); }

            // KOLLA KOLLISION MAT
            // Vanligt äpple
            if(ax == px && ay == py) {
                tail++; score += 10;
                updateScore();
                ax = Math.floor(Math.random() * tileCount);
                ay = Math.floor(Math.random() * tileCount);
            }

            // Bonusäpple
            if (bonus.active && bonus.x == px && bonus.y == py) {
                score += 50; // Massor av poäng!
                tail += 2;   // Växer mer
                updateScore();
                bonus.active = false;
            }

            // RITA MAT
            // Vanligt (Röd glöd)
            ctx.fillStyle = "#ff0055";
            ctx.shadowBlur = 15; ctx.shadowColor = "red";
            ctx.beginPath();
            ctx.arc(ax*gridSize + gridSize/2, ay*gridSize + gridSize/2, gridSize/2 - 2, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;

            // Bonus (Guld glöd)
            if (bonus.active) {
                ctx.fillStyle = "#ffd700"; // Guld
                ctx.shadowBlur = 20; ctx.shadowColor = "yellow";
                ctx.beginPath();
                ctx.arc(bonus.x*gridSize + gridSize/2, bonus.y*gridSize + gridSize/2, gridSize/2 - 1, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function updateScore() {
            document.getElementById("score").innerText = score;
            if(score > highScore) {
                highScore = score;
                document.getElementById("highScore").innerText = highScore;
            }
        }

        function drawFail() {
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#ff0055"; ctx.textAlign = "center";
            ctx.font = "bold 40px Courier New"; ctx.fillText("SYSTEM FAILURE", canvas.width/2, canvas.height/2 - 20);
            ctx.fillStyle = "#00ff41"; ctx.font = "20px Courier New"; ctx.fillText("Tryck SPACE för Reboot", canvas.width/2, canvas.height/2 + 30);
        }

        function keyPush(evt) {
            if(evt.keyCode == 32 && !active) {
                active = true; px=10; py=10; tail=5; score=0; xv=0; yv=0; trail=[]; bonus.active=false;
                updateScore(); return;
            }
            switch(evt.keyCode) {
                case 37: if(xv!==1) {xv=-1;yv=0;} break;
                case 38: if(yv!==1) {xv=0;yv=-1;} break;
                case 39: if(xv!==-1) {xv=1;yv=0;} break;
                case 40: if(yv!==-1) {xv=0;yv=1;} break;
            }
        }
    </script>
</body>
</html>